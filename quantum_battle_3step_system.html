<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quantum Battle System - 3 Step Designer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        /* ステップナビゲーション */
        .step-navigation {
            display: flex;
            justify-content: center;
            margin-bottom: 40px;
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }

        .step-item {
            display: flex;
            align-items: center;
            margin: 0 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #ddd;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 10px;
            transition: all 0.3s ease;
        }

        .step-item.active .step-number {
            background: #667eea;
            transform: scale(1.2);
        }

        .step-item.completed .step-number {
            background: #4CAF50;
        }

        .step-label {
            font-weight: 500;
            color: #999;
            transition: color 0.3s ease;
        }

        .step-item.active .step-label {
            color: #667eea;
            font-weight: bold;
        }

        .step-item.completed .step-label {
            color: #4CAF50;
        }

        .step-connector {
            width: 60px;
            height: 2px;
            background: #ddd;
            margin: 0 10px;
        }

        .step-connector.completed {
            background: #4CAF50;
        }

        /* ステップコンテンツ */
        .step-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .step-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ステップ1: 学習方法選択 */
        .learning-method-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 30px;
            max-width: 1000px;
            margin: 0 auto;
        }

        .method-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
        }

        .method-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }

        .method-card.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #f5f7ff 0%, #e8ecff 100%);
        }

        .method-icon {
            font-size: 3em;
            margin-bottom: 15px;
            text-align: center;
        }

        .method-title {
            font-size: 1.8em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 15px;
            text-align: center;
        }

        .method-description {
            color: #666;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .method-features {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
        }

        .feature-item {
            display: flex;
            align-items: center;
            margin: 8px 0;
            color: #555;
        }

        .feature-icon {
            color: #4CAF50;
            margin-right: 8px;
        }

        /* ステップ2: モジュール設計 (Jupyter Notebook スタイル) */
        .module-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .module-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
        }

        .module-card:hover {
            transform: translateY(-5px);
        }

        .module-title {
            font-size: 1.4em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .module-icon {
            font-size: 1.5em;
        }

        /* Jupyter Notebook スタイル */
        .notebook-cell {
            background: white;
            border-left: 4px solid #4CAF50;
            margin: 20px 0;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .cell-number {
            color: #888;
            font-family: monospace;
            margin-bottom: 10px;
        }

        .run-button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            margin-top: 15px;
            transition: background 0.3s ease;
        }

        .run-button:hover {
            background: #45a049;
        }

        .output-area {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
            font-family: monospace;
            white-space: pre-wrap;
            display: none;
        }

        .module-selector {
            margin-top: 15px;
        }

        .selector-title {
            font-weight: 500;
            color: #666;
            margin-bottom: 10px;
        }

        .quantum-config {
            margin: 15px 0;
        }

        .config-item {
            margin: 15px 0;
        }

        .config-label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }

        /* ステップ3: ハイパーパラメータ設定 */
        .hyperparameter-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .param-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .param-section-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .param-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .param-item {
            display: flex;
            flex-direction: column;
        }

        .param-label {
            font-weight: 500;
            color: #555;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .param-input {
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }

        .param-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .slider {
            flex: 1;
            -webkit-appearance: none;
            height: 8px;
            border-radius: 5px;
            background: #e0e0e0;
            outline: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }

        .value-display {
            min-width: 60px;
            text-align: center;
            background: #667eea;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: bold;
        }

        /* ボタン */
        .button-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
        }

        .btn {
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a67d8;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #e0e0e0;
            color: #666;
        }

        .btn-secondary:hover {
            background: #d0d0d0;
        }

        .btn-success {
            background: #4CAF50;
            color: white;
        }

        .btn-success:hover {
            background: #45a049;
        }

        /* コード出力 */
        .code-output {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 25px;
            border-radius: 10px;
            margin-top: 30px;
            font-family: 'Consolas', 'Monaco', monospace;
            overflow-x: auto;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
        }

        .code-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #444;
        }

        .code-title {
            color: #4CAF50;
            font-weight: bold;
        }

        .copy-button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
        }

        /* モジュール選択ボタン */
        .option-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .option-button {
            padding: 12px;
            background: #f0f0f0;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .option-button:hover {
            background: #e8ecff;
            border-color: #667eea;
        }

        .option-button.selected {
            background: #667eea;
            color: white;
            border-color: #5a67d8;
        }

        /* 配置ボード */
        .placement-board {
            display: grid;
            grid-template-columns: repeat(6, 50px);
            grid-template-rows: repeat(6, 50px);
            gap: 2px;
            margin: 20px auto;
            background: #444;
            padding: 10px;
            border-radius: 10px;
            width: fit-content;
        }

        .board-cell {
            background: #f0f0f0;
            border: 1px solid #ccc;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .board-cell:hover {
            background: #e0e0e0;
        }

        .board-cell.good { background: #a5d6a7; }
        .board-cell.king-good { background: #4CAF50; }
        .board-cell.bad { background: #ef9a9a; }
        .board-cell.king-bad { background: #f44336; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🚀 Quantum Battle System Designer</h1>
            <p>3ステップでAI戦略を設計・学習・実行</p>
        </div>

        <!-- ステップナビゲーション -->
        <div class="step-navigation">
            <div class="step-item active" id="nav-step1" onclick="goToStep(1)">
                <div class="step-number">1</div>
                <div class="step-label">学習方法選択</div>
            </div>
            <div class="step-connector" id="connector1"></div>
            <div class="step-item" id="nav-step2" onclick="goToStep(2)">
                <div class="step-number">2</div>
                <div class="step-label">モジュール設計</div>
            </div>
            <div class="step-connector" id="connector2"></div>
            <div class="step-item" id="nav-step3" onclick="goToStep(3)">
                <div class="step-number">3</div>
                <div class="step-label">パラメータ設定</div>
            </div>
        </div>

        <!-- ステップ1: 学習方法選択 -->
        <div class="step-content active" id="step1">
            <div class="learning-method-container">
                <div class="method-card" id="rl-card" onclick="selectLearningMethod('reinforcement')">
                    <div class="method-icon">🎮</div>
                    <div class="method-title">強化学習</div>
                    <div class="method-description">
                        エージェントが環境と相互作用しながら、試行錯誤を通じて最適な戦略を学習します。
                        実際に対戦を繰り返し、報酬を最大化する行動を習得します。
                    </div>
                    <div class="method-features">
                        <div class="feature-item">
                            <span class="feature-icon">✓</span>
                            自己対戦による学習
                        </div>
                        <div class="feature-item">
                            <span class="feature-icon">✓</span>
                            Q学習・DQNアルゴリズム
                        </div>
                        <div class="feature-item">
                            <span class="feature-icon">✓</span>
                            探索と活用のバランス
                        </div>
                        <div class="feature-item">
                            <span class="feature-icon">✓</span>
                            動的な戦略の獲得
                        </div>
                    </div>
                </div>

                <div class="method-card" id="sl-card" onclick="selectLearningMethod('supervised')">
                    <div class="method-icon">📚</div>
                    <div class="method-title">教師あり学習</div>
                    <div class="method-description">
                        エキスパートプレイヤーの棋譜データから、最適な手を予測するモデルを学習します。
                        人間の戦略を模倣し、高品質な行動を再現します。
                    </div>
                    <div class="method-features">
                        <div class="feature-item">
                            <span class="feature-icon">✓</span>
                            棋譜データからの学習
                        </div>
                        <div class="feature-item">
                            <span class="feature-icon">✓</span>
                            高速な収束
                        </div>
                        <div class="feature-item">
                            <span class="feature-icon">✓</span>
                            安定した性能
                        </div>
                        <div class="feature-item">
                            <span class="feature-icon">✓</span>
                            人間の戦略を模倣
                        </div>
                    </div>
                </div>
            </div>

            <div class="button-container">
                <button class="btn btn-primary" onclick="proceedToStep2()">次へ進む →</button>
            </div>
        </div>

        <!-- ステップ2: モジュール設計 (Jupyter Notebook Style) -->
        <div class="step-content" id="step2">
            <div class="module-grid">
                <!-- モジュール1: 初期配置 -->
                <div class="module-card">
                    <div class="module-title">
                        <span class="module-icon">♟️</span>
                        モジュール1: 初期配置戦略
                    </div>
                    
                    <div class="notebook-cell">
                        <div class="cell-number">In [1]:</div>
                        <p>駒の初期配置を設定します。クリックして配置を変更できます。</p>
                        
                        <div class="placement-board" id="placementBoard"></div>
                        
                        <div class="module-selector">
                            <div class="selector-title">配置テンプレート：</div>
                            <div class="option-grid">
                                <div class="option-button selected" onclick="selectModule('placement', 'standard', event)">
                                    🎯 標準配置
                                </div>
                                <div class="option-button" onclick="selectModule('placement', 'aggressive', event)">
                                    ⚔️ 攻撃配置
                                </div>
                                <div class="option-button" onclick="selectModule('placement', 'defensive', event)">
                                    🛡️ 防御配置
                                </div>
                                <div class="option-button" onclick="selectModule('placement', 'custom', event)">
                                    ✏️ カスタム
                                </div>
                            </div>
                        </div>
                        
                        <button class="run-button" onclick="runPlacement()">▶ 配置を実行</button>
                        <div class="output-area" id="placementOutput"></div>
                    </div>
                </div>

                <!-- モジュール2: 敵駒推定 -->
                <div class="module-card">
                    <div class="module-title">
                        <span class="module-icon">🔬</span>
                        モジュール2: 敵駒推定（CQCNN）
                    </div>
                    
                    <div class="notebook-cell">
                        <div class="cell-number">In [2]:</div>
                        <div class="quantum-config">
                            <div class="config-item">
                                <label class="config-label">🔢 量子ビット数（n_qubits）:</label>
                                <div class="slider-container">
                                    <input type="range" class="slider" id="qubitsSlider" min="4" max="12" value="8" 
                                           oninput="updateSliderValue('qubits', this.value)">
                                    <div class="value-display" id="qubitsValue">8</div>
                                </div>
                            </div>
                            
                            <div class="config-item">
                                <label class="config-label">📚 レイヤー数（n_layers）:</label>
                                <div class="slider-container">
                                    <input type="range" class="slider" id="layersSlider" min="1" max="5" value="3" 
                                           oninput="updateSliderValue('layers', this.value)">
                                    <div class="value-display" id="layersValue">3</div>
                                </div>
                            </div>
                            
                            <div class="module-selector">
                                <div class="selector-title">エンベディング方式：</div>
                                <div class="option-grid">
                                    <div class="option-button selected" onclick="selectModule('embedding', 'angle', event)">
                                        📐 Angle
                                    </div>
                                    <div class="option-button" onclick="selectModule('embedding', 'amplitude', event)">
                                        📊 Amplitude
                                    </div>
                                </div>
                            </div>
                            
                            <div class="module-selector" style="margin-top: 15px;">
                                <div class="selector-title">エンタングルメント構造：</div>
                                <div class="option-grid">
                                    <div class="option-button selected" onclick="selectModule('entanglement', 'linear', event)">
                                        Linear
                                    </div>
                                    <div class="option-button" onclick="selectModule('entanglement', 'full', event)">
                                        Full
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <button class="run-button" onclick="runQuantumConfig()">▶ 量子回路を構築</button>
                        <div class="output-area" id="quantumOutput"></div>
                    </div>
                </div>

                <!-- モジュール3: 報酬関数 -->
                <div class="module-card">
                    <div class="module-title">
                        <span class="module-icon">💰</span>
                        モジュール3: 報酬関数
                    </div>
                    
                    <div class="notebook-cell">
                        <div class="cell-number">In [3]:</div>
                        <div class="module-selector">
                            <div class="selector-title">報酬戦略を選択：</div>
                            <div class="option-grid">
                                <div class="option-button selected" onclick="selectModule('reward', 'balanced', event)">
                                    ⚖️ バランス型
                                </div>
                                <div class="option-button" onclick="selectModule('reward', 'aggressive', event)">
                                    🗡️ 攻撃重視
                                </div>
                                <div class="option-button" onclick="selectModule('reward', 'defensive', event)">
                                    🛡️ 防御重視
                                </div>
                                <div class="option-button" onclick="selectModule('reward', 'escape', event)">
                                    🏃 脱出重視
                                </div>
                            </div>
                        </div>
                        
                        <button class="run-button" onclick="runReward()">▶ 報酬関数を設定</button>
                        <div class="output-area" id="rewardOutput"></div>
                    </div>
                </div>

                <!-- モジュール4: Q値マップ -->
                <div class="module-card">
                    <div class="module-title">
                        <span class="module-icon">🗺️</span>
                        モジュール4: Q値マップ
                    </div>
                    
                    <div class="notebook-cell">
                        <div class="cell-number">In [4]:</div>
                        <div class="module-selector">
                            <div class="selector-title">Q値計算方法：</div>
                            <div class="option-grid">
                                <div class="option-button selected" onclick="selectModule('qmap', 'dqn', event)">
                                    🧠 DQN
                                </div>
                                <div class="option-button" onclick="selectModule('qmap', 'sarsa', event)">
                                    📈 SARSA
                                </div>
                                <div class="option-button" onclick="selectModule('qmap', 'montecarlo', event)">
                                    🎲 モンテカルロ
                                </div>
                                <div class="option-button" onclick="selectModule('qmap', 'tabular', event)">
                                    📊 テーブル型
                                </div>
                            </div>
                        </div>
                        
                        <button class="run-button" onclick="runQMap()">▶ Q値マップを生成</button>
                        <div class="output-area" id="qmapOutput"></div>
                    </div>
                </div>

                <!-- モジュール5: 行動選択 -->
                <div class="module-card">
                    <div class="module-title">
                        <span class="module-icon">🎯</span>
                        モジュール5: 行動選択
                    </div>
                    
                    <div class="notebook-cell">
                        <div class="cell-number">In [5]:</div>
                        <div class="module-selector">
                            <div class="selector-title">行動選択戦略：</div>
                            <div class="option-grid">
                                <div class="option-button selected" onclick="selectModule('action', 'epsilon', event)">
                                    🎰 ε-greedy
                                </div>
                                <div class="option-button" onclick="selectModule('action', 'boltzmann', event)">
                                    🌡️ ボルツマン
                                </div>
                                <div class="option-button" onclick="selectModule('action', 'ucb', event)">
                                    📊 UCB
                                </div>
                                <div class="option-button" onclick="selectModule('action', 'thompson', event)">
                                    🎲 トンプソン
                                </div>
                            </div>
                        </div>
                        
                        <button class="run-button" onclick="runAction()">▶ 行動選択戦略を設定</button>
                        <div class="output-area" id="actionOutput"></div>
                    </div>
                </div>
            </div>

            <div class="button-container">
                <button class="btn btn-secondary" onclick="goToStep(1)">← 戻る</button>
                <button class="btn btn-primary" onclick="proceedToStep3()">次へ進む →</button>
            </div>
        </div>

        <!-- ステップ3: ハイパーパラメータ設定 -->
        <div class="step-content" id="step3">
            <div class="hyperparameter-container">
                <!-- 学習設定 -->
                <div class="param-section">
                    <div class="param-section-title">
                        <span>⚙️</span>
                        学習設定
                    </div>
                    <div class="param-grid">
                        <div class="param-item">
                            <label class="param-label">
                                <span>📊</span> 学習率 (Learning Rate)
                            </label>
                            <div class="slider-container">
                                <input type="range" class="slider" min="-4" max="-1" value="-3" step="0.1"
                                       oninput="updateLearningRate(this.value)">
                                <div class="value-display" id="lrValue">0.001</div>
                            </div>
                        </div>
                        <div class="param-item">
                            <label class="param-label">
                                <span>📦</span> バッチサイズ
                            </label>
                            <select class="param-input" id="batchSize">
                                <option value="16">16</option>
                                <option value="32" selected>32</option>
                                <option value="64">64</option>
                                <option value="128">128</option>
                                <option value="256">256</option>
                            </select>
                        </div>
                        <div class="param-item">
                            <label class="param-label">
                                <span>🔄</span> エポック数
                            </label>
                            <input type="number" class="param-input" id="epochs" value="100" min="10" max="1000">
                        </div>
                        <div class="param-item">
                            <label class="param-label">
                                <span>🎯</span> 検証データ割合
                            </label>
                            <div class="slider-container">
                                <input type="range" class="slider" min="0.1" max="0.4" value="0.2" step="0.05"
                                       oninput="updateSliderValue('validation', this.value)">
                                <div class="value-display" id="validationValue">0.2</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 強化学習固有のパラメータ -->
                <div class="param-section" id="rlParams">
                    <div class="param-section-title">
                        <span>🎮</span>
                        強化学習パラメータ
                    </div>
                    <div class="param-grid">
                        <div class="param-item">
                            <label class="param-label">
                                <span>🎰</span> ε (Epsilon)
                            </label>
                            <div class="slider-container">
                                <input type="range" class="slider" min="0" max="1" value="0.1" step="0.01"
                                       oninput="updateSliderValue('epsilon', this.value)">
                                <div class="value-display" id="epsilonValue">0.1</div>
                            </div>
                        </div>
                        <div class="param-item">
                            <label class="param-label">
                                <span>📉</span> ε減衰率
                            </label>
                            <div class="slider-container">
                                <input type="range" class="slider" min="0.99" max="1" value="0.995" step="0.001"
                                       oninput="updateSliderValue('epsilonDecay', this.value)">
                                <div class="value-display" id="epsilonDecayValue">0.995</div>
                            </div>
                        </div>
                        <div class="param-item">
                            <label class="param-label">
                                <span>💾</span> リプレイバッファサイズ
                            </label>
                            <select class="param-input" id="replayBuffer">
                                <option value="1000">1,000</option>
                                <option value="5000">5,000</option>
                                <option value="10000" selected>10,000</option>
                                <option value="50000">50,000</option>
                            </select>
                        </div>
                        <div class="param-item">
                            <label class="param-label">
                                <span>🎯</span> 割引率 (γ)
                            </label>
                            <div class="slider-container">
                                <input type="range" class="slider" min="0.9" max="1" value="0.99" step="0.01"
                                       oninput="updateSliderValue('gamma', this.value)">
                                <div class="value-display" id="gammaValue">0.99</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 教師あり学習固有のパラメータ -->
                <div class="param-section" id="slParams" style="display: none;">
                    <div class="param-section-title">
                        <span>📚</span>
                        教師あり学習パラメータ
                    </div>
                    <div class="param-grid">
                        <div class="param-item">
                            <label class="param-label">
                                <span>📂</span> データセットパス
                            </label>
                            <input type="text" class="param-input" placeholder="path/to/dataset.csv" id="datasetPath">
                        </div>
                        <div class="param-item">
                            <label class="param-label">
                                <span>🔀</span> データ拡張
                            </label>
                            <select class="param-input" id="augmentation">
                                <option value="none">なし</option>
                                <option value="rotation">回転</option>
                                <option value="flip">反転</option>
                                <option value="all" selected>すべて</option>
                            </select>
                        </div>
                        <div class="param-item">
                            <label class="param-label">
                                <span>⚖️</span> クラス重み付け
                            </label>
                            <select class="param-input" id="classWeight">
                                <option value="none">なし</option>
                                <option value="balanced" selected>バランス</option>
                                <option value="custom">カスタム</option>
                            </select>
                        </div>
                        <div class="param-item">
                            <label class="param-label">
                                <span>📊</span> 損失関数
                            </label>
                            <select class="param-input" id="lossFunction">
                                <option value="cross_entropy" selected>クロスエントロピー</option>
                                <option value="mse">MSE</option>
                                <option value="focal">Focal Loss</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- 最適化設定 -->
                <div class="param-section">
                    <div class="param-section-title">
                        <span>🚀</span>
                        最適化設定
                    </div>
                    <div class="param-grid">
                        <div class="param-item">
                            <label class="param-label">
                                <span>⚡</span> オプティマイザ
                            </label>
                            <select class="param-input" id="optimizer">
                                <option value="adam" selected>Adam</option>
                                <option value="sgd">SGD</option>
                                <option value="rmsprop">RMSprop</option>
                                <option value="adamw">AdamW</option>
                            </select>
                        </div>
                        <div class="param-item">
                            <label class="param-label">
                                <span>📈</span> 学習率スケジューラ
                            </label>
                            <select class="param-input" id="scheduler">
                                <option value="none">なし</option>
                                <option value="step">Step</option>
                                <option value="cosine" selected>Cosine</option>
                                <option value="exponential">Exponential</option>
                            </select>
                        </div>
                        <div class="param-item">
                            <label class="param-label">
                                <span>💧</span> Dropout率
                            </label>
                            <div class="slider-container">
                                <input type="range" class="slider" min="0" max="0.5" value="0.2" step="0.05"
                                       oninput="updateSliderValue('dropout', this.value)">
                                <div class="value-display" id="dropoutValue">0.2</div>
                            </div>
                        </div>
                        <div class="param-item">
                            <label class="param-label">
                                <span>🔒</span> L2正則化
                            </label>
                            <div class="slider-container">
                                <input type="range" class="slider" min="-5" max="-2" value="-4" step="0.5"
                                       oninput="updateL2Reg(this.value)">
                                <div class="value-display" id="l2Value">0.0001</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="button-container">
                    <button class="btn btn-secondary" onclick="goToStep(2)">← 戻る</button>
                    <button class="btn btn-success" onclick="generateCode()">コード生成 🚀</button>
                </div>
            </div>

            <!-- コード出力エリア -->
            <div class="code-output" id="codeOutput" style="display: none;">
                <div class="code-header">
                    <div class="code-title">📝 Generated Python Code</div>
                    <button class="copy-button" onclick="copyCode()">📋 コピー</button>
                </div>
                <pre id="generatedCode"></pre>
            </div>
        </div>
    </div>

    <script>
        // 設定管理
        const config = {
            learningMethod: '',
            placement: 'standard',
            qubits: 8,
            layers: 3,
            embedding: 'angle',
            entanglement: 'linear',
            reward: 'balanced',
            qmap: 'dqn',
            action: 'epsilon',
            board: Array(6).fill().map(() => Array(6).fill(0))
        };

        const hyperparams = {
            learningRate: 0.001,
            batchSize: 32,
            epochs: 100,
            validation: 0.2,
            epsilon: 0.1,
            epsilonDecay: 0.995,
            replayBuffer: 10000,
            gamma: 0.99,
            dropout: 0.2,
            l2Reg: 0.0001,
            optimizer: 'adam',
            scheduler: 'cosine'
        };

        // 初期化
        window.onload = () => {
            initializeBoard();
        };

        // ボード初期化
        function initializeBoard() {
            const board = document.getElementById('placementBoard');
            if (!board) return;
            
            board.innerHTML = '';
            const standardLayout = [
                [1, 1, 0, 0, -1, -1],
                [1, 0, 0, 0, 0, -1],
                [0, 0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0, 0],
                [2, 0, 0, 0, 0, -2],
                [1, 1, 0, 0, -1, -1]
            ];
            
            for (let i = 0; i < 6; i++) {
                for (let j = 0; j < 6; j++) {
                    const cell = document.createElement('div');
                    cell.className = 'board-cell';
                    cell.dataset.row = i;
                    cell.dataset.col = j;
                    
                    const value = standardLayout[i][j];
                    if (value === 1) {
                        cell.classList.add('good');
                        cell.textContent = '○';
                    } else if (value === 2) {
                        cell.classList.add('king-good');
                        cell.textContent = '◎';
                    } else if (value === -1) {
                        cell.classList.add('bad');
                        cell.textContent = '●';
                    } else if (value === -2) {
                        cell.classList.add('king-bad');
                        cell.textContent = '◉';
                    }
                    
                    config.board[i][j] = value;
                    cell.onclick = () => togglePiece(i, j);
                    board.appendChild(cell);
                }
            }
        }

        // モジュール実行関数（Jupyter Notebook スタイル）
        function runPlacement() {
            const output = document.getElementById('placementOutput');
            output.style.display = 'block';
            let goodCount = 0, badCount = 0;
            for (let row of config.board) {
                for (let val of row) {
                    if (val > 0) goodCount++;
                    if (val < 0) badCount++;
                }
            }
            output.textContent = `✅ 初期配置設定完了
配置タイプ: ${config.placement}
善玉の位置: ${goodCount}個
悪玉の位置: ${badCount}個`;
        }

        function runQuantumConfig() {
            const output = document.getElementById('quantumOutput');
            output.style.display = 'block';
            output.textContent = `✅ 量子回路構築完了
量子ビット数: ${config.qubits}
レイヤー数: ${config.layers}
エンベディング: ${config.embedding}
エンタングルメント: ${config.entanglement}
総パラメータ数: ${config.qubits * config.layers * 3}`;
        }

        function runReward() {
            const output = document.getElementById('rewardOutput');
            output.style.display = 'block';
            const rewards = {
                balanced: '捕獲: +10, 脱出: +50, 被捕獲: -10',
                aggressive: '捕獲: +20, 脱出: +30, 被捕獲: -5',
                defensive: '捕獲: +5, 脱出: +40, 被捕獲: -20',
                escape: '捕獲: +5, 脱出: +100, 被捕獲: -10'
            };
            output.textContent = `✅ 報酬関数設定完了
戦略: ${config.reward}
${rewards[config.reward]}`;
        }

        function runQMap() {
            const output = document.getElementById('qmapOutput');
            output.style.display = 'block';
            output.textContent = `✅ Q値マップ生成完了
方法: ${config.qmap}
状態空間: 6x6x4 = 144次元
行動空間: 4方向`;
        }

        function runAction() {
            const output = document.getElementById('actionOutput');
            output.style.display = 'block';
            const strategies = {
                epsilon: 'ε=0.1で10%の確率でランダム探索',
                boltzmann: '温度τ=1.0でソフトマックス選択',
                ucb: '信頼区間による楽観的探索',
                thompson: 'ベイズ的確率分布からサンプリング'
            };
            output.textContent = `✅ 行動選択戦略設定完了
戦略: ${config.action}
${strategies[config.action]}`;
        }

        // ピース切り替え
        function togglePiece(row, col) {
            if (config.placement !== 'custom') {
                alert('カスタムモードを選択してください');
                return;
            }
            
            const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
            const current = config.board[row][col];
            const next = current === 0 ? 1 : current === 1 ? 2 : current === 2 ? -1 : current === -1 ? -2 : 0;
            
            config.board[row][col] = next;
            
            // クラスとテキストを更新
            cell.className = 'board-cell';
            if (next === 1) {
                cell.classList.add('good');
                cell.textContent = '○';
            } else if (next === 2) {
                cell.classList.add('king-good');
                cell.textContent = '◎';
            } else if (next === -1) {
                cell.classList.add('bad');
                cell.textContent = '●';
            } else if (next === -2) {
                cell.classList.add('king-bad');
                cell.textContent = '◉';
            } else {
                cell.textContent = '';
            }
        }

        // 学習方法選択
        function selectLearningMethod(method) {
            config.learningMethod = method;
            
            document.querySelectorAll('.method-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            if (method === 'reinforcement') {
                document.getElementById('rl-card').classList.add('selected');
            } else {
                document.getElementById('sl-card').classList.add('selected');
            }
        }

        // ステップ2へ進む
        function proceedToStep2() {
            if (!config.learningMethod) {
                alert('学習方法を選択してください');
                return;
            }
            goToStep(2);
        }

        // ステップ3へ進む
        function proceedToStep3() {
            goToStep(3);
            
            // 学習方法に応じてパラメータセクションを表示/非表示
            if (config.learningMethod === 'reinforcement') {
                document.getElementById('rlParams').style.display = 'block';
                document.getElementById('slParams').style.display = 'none';
            } else {
                document.getElementById('rlParams').style.display = 'none';
                document.getElementById('slParams').style.display = 'block';
            }
        }

        // ステップ遷移
        function goToStep(stepNum) {
            // すべてのステップを非表示
            document.querySelectorAll('.step-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // 指定されたステップを表示
            document.getElementById(`step${stepNum}`).classList.add('active');
            
            // ナビゲーション更新
            for (let i = 1; i <= 3; i++) {
                const navItem = document.getElementById(`nav-step${i}`);
                if (i < stepNum) {
                    navItem.classList.add('completed');
                    navItem.classList.remove('active');
                } else if (i === stepNum) {
                    navItem.classList.add('active');
                    navItem.classList.remove('completed');
                } else {
                    navItem.classList.remove('active', 'completed');
                }
            }
            
            // コネクタ更新
            if (stepNum > 1) {
                document.getElementById('connector1').classList.add('completed');
            } else {
                document.getElementById('connector1').classList.remove('completed');
            }
            
            if (stepNum > 2) {
                document.getElementById('connector2').classList.add('completed');
            } else {
                document.getElementById('connector2').classList.remove('completed');
            }
        }

        // モジュール選択
        function selectModule(type, value, event) {
            config[type] = value;
            
            // ボタンの選択状態を更新
            const container = event.target.parentElement;
            container.querySelectorAll('.option-button').forEach(btn => {
                btn.classList.remove('selected');
            });
            event.target.classList.add('selected');
            
            // 配置タイプが変更された場合、ボードを更新
            if (type === 'placement') {
                updateBoardLayout(value);
            }
        }
        
        // ボードレイアウト更新
        function updateBoardLayout(layoutType) {
            const layouts = {
                standard: [
                    [1, 1, 0, 0, -1, -1],
                    [1, 0, 0, 0, 0, -1],
                    [0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0],
                    [2, 0, 0, 0, 0, -2],
                    [1, 1, 0, 0, -1, -1]
                ],
                aggressive: [
                    [1, 1, 1, 0, -1, -1],
                    [1, 2, 0, 0, -2, -1],
                    [1, 0, 0, 0, 0, -1],
                    [0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0],
                    [0, 0, 0, -1, -1, -1]
                ],
                defensive: [
                    [0, 0, 0, 0, 0, 0],
                    [1, 1, 0, 0, -1, -1],
                    [1, 0, 0, 0, 0, -1],
                    [2, 0, 0, 0, 0, -2],
                    [1, 0, 0, 0, 0, -1],
                    [1, 1, 0, 0, -1, -1]
                ],
                custom: config.board
            };
            
            if (layoutType !== 'custom') {
                const layout = layouts[layoutType];
                const board = document.getElementById('placementBoard');
                const cells = board.querySelectorAll('.board-cell');
                
                cells.forEach((cell, index) => {
                    const row = Math.floor(index / 6);
                    const col = index % 6;
                    const value = layout[row][col];
                    
                    config.board[row][col] = value;
                    
                    // クラスとテキストを更新
                    cell.className = 'board-cell';
                    if (value === 1) {
                        cell.classList.add('good');
                        cell.textContent = '○';
                    } else if (value === 2) {
                        cell.classList.add('king-good');
                        cell.textContent = '◎';
                    } else if (value === -1) {
                        cell.classList.add('bad');
                        cell.textContent = '●';
                    } else if (value === -2) {
                        cell.classList.add('king-bad');
                        cell.textContent = '◉';
                    } else {
                        cell.textContent = '';
                    }
                });
            }
        }

        // スライダー値更新
        function updateSliderValue(param, value) {
            document.getElementById(`${param}Value`).textContent = value;
            if (param === 'qubits' || param === 'layers') {
                config[param] = parseInt(value);
            } else {
                hyperparams[param] = parseFloat(value);
            }
        }

        // 学習率更新（対数スケール）
        function updateLearningRate(value) {
            const lr = Math.pow(10, parseFloat(value));
            hyperparams.learningRate = lr;
            document.getElementById('lrValue').textContent = lr.toFixed(4);
        }

        // L2正則化更新（対数スケール）
        function updateL2Reg(value) {
            const l2 = Math.pow(10, parseFloat(value));
            hyperparams.l2Reg = l2;
            document.getElementById('l2Value').textContent = l2.toFixed(5);
        }

        // コード生成
        function generateCode() {
            const code = `# ============================================
# Quantum Battle System - Auto-Generated Code
# ============================================
# 学習方法: ${config.learningMethod === 'reinforcement' ? '強化学習' : '教師あり学習'}
# 生成日時: ${new Date().toLocaleString('ja-JP')}

import numpy as np
import torch
import torch.nn as nn
import torch.optim as optim
from quantum_battle_system import QuantumBattleSystem

# ===== システム初期化 =====
system = QuantumBattleSystem()

# ===== 学習方法の設定 =====
learning_config = {
    'method': '${config.learningMethod}',
    'algorithm': '${config.learningMethod === 'reinforcement' ? config.qmap : 'supervised'}',
}

# ===== モジュール設定 =====
module_config = {
    # モジュール1: 初期配置
    'placement': {
        'type': '${config.placement}',
        'board': np.array([
${config.board.map(row => '            ' + JSON.stringify(row)).join(',\n')}
        ])
    },
    
    # モジュール2: 敵駒推定（CQCNN）
    'quantum': {
        'n_qubits': ${config.qubits},
        'n_layers': ${config.layers},
        'embedding_type': '${config.embedding}',
        'entanglement': '${config.entanglement}',
        'total_params': ${config.qubits * config.layers * 3}
    },
    
    # モジュール3: 報酬関数
    'reward': {
        'strategy': '${config.reward}',
        'capture_reward': ${config.reward === 'aggressive' ? 20 : config.reward === 'defensive' ? 5 : 10},
        'escape_reward': ${config.reward === 'escape' ? 100 : config.reward === 'defensive' ? 40 : 50},
        'captured_penalty': ${config.reward === 'defensive' ? -20 : -10}
    },
    
    # モジュール4: Q値計算
    'qmap': {
        'method': '${config.qmap}',
        'state_dim': 144,  # 6x6x4
        'action_dim': 4     # 4方向
    },
    
    # モジュール5: 行動選択
    'action': {
        'strategy': '${config.action}',
        'epsilon': ${config.action === 'epsilon' ? hyperparams.epsilon : 'None'},
        'temperature': ${config.action === 'boltzmann' ? '1.0' : 'None'}
    }
}

# ===== ハイパーパラメータ =====
hyperparameters = {
    # 基本学習設定
    'learning_rate': ${hyperparams.learningRate},
    'batch_size': ${document.getElementById('batchSize').value},
    'epochs': ${document.getElementById('epochs').value},
    'validation_split': ${hyperparams.validation},
    
    # 最適化設定
    'optimizer': '${document.getElementById('optimizer').value}',
    'scheduler': '${document.getElementById('scheduler').value}',
    'dropout_rate': ${hyperparams.dropout},
    'l2_regularization': ${hyperparams.l2Reg},
    ${config.learningMethod === 'reinforcement' ? `
    # 強化学習パラメータ
    'epsilon': ${hyperparams.epsilon},
    'epsilon_decay': ${hyperparams.epsilonDecay},
    'epsilon_min': 0.01,
    'gamma': ${hyperparams.gamma},
    'replay_buffer_size': ${document.getElementById('replayBuffer').value},
    'target_update_freq': 100,` : `
    # 教師あり学習パラメータ
    'dataset_path': '${document.getElementById('datasetPath').value || 'path/to/dataset.csv'}',
    'augmentation': '${document.getElementById('augmentation').value}',
    'class_weight': '${document.getElementById('classWeight').value}',
    'loss_function': '${document.getElementById('lossFunction').value}',`}
}

# ===== モデル構築 =====
class QuantumBattleAI(nn.Module):
    def __init__(self, config):
        super().__init__()
        self.config = config
        
        # CQCNNエンコーダ
        self.quantum_encoder = self._build_quantum_encoder()
        
        # 古典的デコーダ
        self.classical_decoder = nn.Sequential(
            nn.Linear(config['quantum']['n_qubits'], 128),
            nn.ReLU(),
            nn.Dropout(hyperparameters['dropout_rate']),
            nn.Linear(128, 64),
            nn.ReLU(),
            nn.Dropout(hyperparameters['dropout_rate']),
            nn.Linear(64, 4)  # 4方向の行動
        )
    
    def _build_quantum_encoder(self):
        # 量子回路の構築
        from pennylane import numpy as qnp
        import pennylane as qml
        
        n_qubits = self.config['quantum']['n_qubits']
        n_layers = self.config['quantum']['n_layers']
        
        dev = qml.device('default.qubit', wires=n_qubits)
        
        @qml.qnode(dev)
        def quantum_circuit(inputs, weights):
            # データエンコーディング
            for i in range(n_qubits):
                if self.config['quantum']['embedding_type'] == 'angle':
                    qml.RY(inputs[i], wires=i)
                else:
                    qml.RX(inputs[i], wires=i)
            
            # パラメータ化量子回路
            for l in range(n_layers):
                # 回転層
                for i in range(n_qubits):
                    qml.RY(weights[l][i][0], wires=i)
                    qml.RZ(weights[l][i][1], wires=i)
                
                # エンタングルメント層
                if self.config['quantum']['entanglement'] == 'linear':
                    for i in range(n_qubits - 1):
                        qml.CNOT(wires=[i, i+1])
                elif self.config['quantum']['entanglement'] == 'full':
                    for i in range(n_qubits):
                        for j in range(i+1, n_qubits):
                            qml.CZ(wires=[i, j])
            
            # 測定
            return [qml.expval(qml.PauliZ(i)) for i in range(n_qubits)]
        
        return quantum_circuit
    
    def forward(self, x):
        # 量子エンコーディング
        quantum_features = self.quantum_encoder(x)
        
        # 古典的処理
        output = self.classical_decoder(quantum_features)
        
        return output

# ===== 学習プロセス =====
def train_model(model, config, hyperparameters):
    # オプティマイザ設定
    if hyperparameters['optimizer'] == 'adam':
        optimizer = optim.Adam(
            model.parameters(), 
            lr=hyperparameters['learning_rate'],
            weight_decay=hyperparameters['l2_regularization']
        )
    elif hyperparameters['optimizer'] == 'sgd':
        optimizer = optim.SGD(
            model.parameters(),
            lr=hyperparameters['learning_rate'],
            momentum=0.9,
            weight_decay=hyperparameters['l2_regularization']
        )
    
    # スケジューラ設定
    if hyperparameters['scheduler'] == 'cosine':
        scheduler = optim.lr_scheduler.CosineAnnealingLR(
            optimizer, T_max=hyperparameters['epochs']
        )
    elif hyperparameters['scheduler'] == 'step':
        scheduler = optim.lr_scheduler.StepLR(
            optimizer, step_size=30, gamma=0.1
        )
    else:
        scheduler = None
    
    ${config.learningMethod === 'reinforcement' ? `# 強化学習ループ
    from collections import deque
    import random
    
    # リプレイバッファ
    replay_buffer = deque(maxlen=hyperparameters['replay_buffer_size'])
    
    # ε-greedy パラメータ
    epsilon = hyperparameters['epsilon']
    
    for episode in range(hyperparameters['epochs']):
        state = system.reset()
        total_reward = 0
        done = False
        
        while not done:
            # 行動選択
            if random.random() < epsilon:
                action = random.choice(range(4))
            else:
                with torch.no_grad():
                    q_values = model(state)
                    action = q_values.argmax().item()
            
            # 環境との相互作用
            next_state, reward, done = system.step(action)
            
            # リプレイバッファに保存
            replay_buffer.append((state, action, reward, next_state, done))
            
            # ミニバッチ学習
            if len(replay_buffer) >= hyperparameters['batch_size']:
                batch = random.sample(replay_buffer, hyperparameters['batch_size'])
                states, actions, rewards, next_states, dones = zip(*batch)
                
                # Q値の計算と更新
                current_q = model(torch.tensor(states))
                next_q = model(torch.tensor(next_states))
                target_q = rewards + hyperparameters['gamma'] * next_q.max(1)[0] * (1 - dones)
                
                loss = nn.MSELoss()(current_q.gather(1, actions), target_q)
                
                optimizer.zero_grad()
                loss.backward()
                optimizer.step()
            
            state = next_state
            total_reward += reward
        
        # εの減衰
        epsilon = max(0.01, epsilon * hyperparameters['epsilon_decay'])
        
        # スケジューラ更新
        if scheduler:
            scheduler.step()
        
        print(f"Episode {episode}: Total Reward = {total_reward:.2f}, ε = {epsilon:.4f}")` : `# 教師あり学習ループ
    from torch.utils.data import DataLoader, TensorDataset
    import pandas as pd
    
    # データセット読み込み
    data = pd.read_csv(hyperparameters['dataset_path'])
    X_train = torch.tensor(data.iloc[:, :-1].values, dtype=torch.float32)
    y_train = torch.tensor(data.iloc[:, -1].values, dtype=torch.long)
    
    # データローダー作成
    dataset = TensorDataset(X_train, y_train)
    train_size = int((1 - hyperparameters['validation_split']) * len(dataset))
    val_size = len(dataset) - train_size
    train_dataset, val_dataset = torch.utils.data.random_split(dataset, [train_size, val_size])
    
    train_loader = DataLoader(train_dataset, batch_size=hyperparameters['batch_size'], shuffle=True)
    val_loader = DataLoader(val_dataset, batch_size=hyperparameters['batch_size'])
    
    # 損失関数
    if hyperparameters['loss_function'] == 'cross_entropy':
        criterion = nn.CrossEntropyLoss()
    elif hyperparameters['loss_function'] == 'mse':
        criterion = nn.MSELoss()
    
    # 学習ループ
    for epoch in range(hyperparameters['epochs']):
        # 訓練フェーズ
        model.train()
        train_loss = 0
        train_correct = 0
        
        for batch_x, batch_y in train_loader:
            optimizer.zero_grad()
            outputs = model(batch_x)
            loss = criterion(outputs, batch_y)
            loss.backward()
            optimizer.step()
            
            train_loss += loss.item()
            _, predicted = torch.max(outputs.data, 1)
            train_correct += (predicted == batch_y).sum().item()
        
        # 検証フェーズ
        model.eval()
        val_loss = 0
        val_correct = 0
        
        with torch.no_grad():
            for batch_x, batch_y in val_loader:
                outputs = model(batch_x)
                loss = criterion(outputs, batch_y)
                
                val_loss += loss.item()
                _, predicted = torch.max(outputs.data, 1)
                val_correct += (predicted == batch_y).sum().item()
        
        # スケジューラ更新
        if scheduler:
            scheduler.step()
        
        print(f"Epoch {epoch}/{hyperparameters['epochs']}")
        print(f"Train Loss: {train_loss/len(train_loader):.4f}, Train Acc: {train_correct/train_size:.4f}")
        print(f"Val Loss: {val_loss/len(val_loader):.4f}, Val Acc: {val_correct/val_size:.4f}")`}
    
    return model

# ===== メイン実行 =====
if __name__ == "__main__":
    # モデル初期化
    model = QuantumBattleAI(module_config)
    
    print("========================================")
    print("Quantum Battle System - Training Started")
    print("========================================")
    print(f"学習方法: ${config.learningMethod === 'reinforcement' ? '強化学習' : '教師あり学習'}")
    print(f"量子ビット数: {module_config['quantum']['n_qubits']}")
    print(f"レイヤー数: {module_config['quantum']['n_layers']}")
    print(f"総パラメータ数: {sum(p.numel() for p in model.parameters())}")
    print("========================================\\n")
    
    # 学習実行
    trained_model = train_model(model, module_config, hyperparameters)
    
    # モデル保存
    torch.save({
        'model_state_dict': trained_model.state_dict(),
        'module_config': module_config,
        'hyperparameters': hyperparameters,
        'learning_method': learning_config
    }, 'quantum_battle_model.pth')
    
    print("\\n========================================")
    print("Training Complete! Model saved as 'quantum_battle_model.pth'")
    print("========================================")
`;

            document.getElementById('generatedCode').textContent = code;
            document.getElementById('codeOutput').style.display = 'block';
            
            // スクロール
            document.getElementById('codeOutput').scrollIntoView({ behavior: 'smooth' });
        }

        // コードコピー
        function copyCode() {
            const code = document.getElementById('generatedCode').textContent;
            navigator.clipboard.writeText(code).then(() => {
                alert('コードをクリップボードにコピーしました！');
            });
        }
    </script>
</body>
</html>